SELECT TO_CHAR(SALES_DATE, 'YYYY') YEAR,
       TO_NUMBER(TO_CHAR(SALES_DATE, 'mm')) MONTH,
       COUNT(DISTINCT U.USER_ID) PUCHASED_USERS,
       ROUND(COUNT(DISTINCT U.USER_ID) / MAX(CNT), 1) PUCHASED_RATIO
FROM ONLINE_SALE O
JOIN (
    SELECT USER_ID, TO_CHAR(JOINED, 'YYYY') J_YEAR, CNT
    FROM USER_INFO U1
    JOIN (
        SELECT TO_CHAR(JOINED, 'YYYY') J_YEAR, COUNT(*) CNT
        FROM USER_INFO
        WHERE TO_CHAR(JOINED, 'YYYY') = '2021'
        GROUP BY TO_CHAR(JOINED, 'YYYY')) U2
    ON TO_CHAR(U1.JOINED, 'YYYY') = U2.J_YEAR
    WHERE TO_CHAR(JOINED, 'YYYY') = '2021'
) U
ON O.USER_ID = U.USER_ID
GROUP BY (TO_CHAR(SALES_DATE, 'YYYY'), TO_NUMBER(TO_CHAR(SALES_DATE, 'mm')))
ORDER BY 1,2